import QtQuick
import QtQuick.Controls
import QtGraphs
import QtQuick.VirtualKeyboard

Item {
    id: root
    anchors.fill: parent
    
    // Кэшируем состояние подключения для мгновенного доступа без синхронных операций
    // Инициализируем через сигнал после загрузки компонента, чтобы не блокировать рендеринг
    property bool cachedIsConnected: false
    
    // IR spectrum: обновляем по событию подключения + по приходу данных.
    // (Не держим таймер — оба экрана всегда загружены, иначе будем дергать IR даже когда экран "сзади")
    function _updateDashedVerticalMarker(markerSegments, xVal, yLo, yHi, xMin, xMax, tag) {
        if (!markerSegments || markerSegments.length === 0) return
        // всегда чистим старые сегменты
        for (var c = 0; c < markerSegments.length; c++) {
            try { if (markerSegments[c].clear) markerSegments[c].clear() } catch (e0) {}
        }
        if (!isFinite(xVal) || isNaN(xVal) || !isFinite(yLo) || !isFinite(yHi) || yHi <= yLo || xVal < xMin || xVal > xMax) {
            console.log("[IR] Clinicalmode: marker(" + tag + ") out of X range:", xVal, "range=", xMin, xMax)
            return
        }
        var total = yHi - yLo
        var dash = total / (markerSegments.length * 2.0) // dash + gap
        if (!isFinite(dash) || dash <= 0) return
        for (var i = 0; i < markerSegments.length; i++) {
            var seg = markerSegments[i]
            var ys = yLo + (i * 2.0) * dash
            if (ys >= yHi) break
            var ye = Math.min(ys + dash, yHi)
            try {
                if (seg.append) { seg.append(xVal, ys); seg.append(xVal, ye) }
            } catch (e1) {
                console.log("[IR] Clinicalmode: marker(" + tag + ") append failed:", i, xVal, ys, ye, e1)
            }
        }
    }

    function updateIrGraph(payload) {
        console.log("[IR] Clinicalmode updateIrGraph payload=", payload)
        if (!payload) {
            console.log("[IR] Clinicalmode: payload is null/undefined")
            return
        }

        // Предпочитаем payload.data_json (самый надежный способ получить массив чисел в QML)
        var ys = null
        if (payload.data_json !== undefined && payload.data_json !== null && payload.data_json !== "") {
            try {
                ys = JSON.parse(payload.data_json)
            } catch (ejson) {
                console.log("[IR] Clinicalmode: JSON.parse(data_json) failed:", ejson, payload.data_json)
                ys = payload.data
            }
        } else {
            ys = payload.data
        }
        if (!ys || ys.length === 0) {
            console.log("[IR] Clinicalmode: no data to draw", payload.data, payload.points)
            return
        }

        // X берём из метаданных устройства: x_min (401-402), x_max (403-404)
        var x0 = Number(payload.x_min)
        var x1 = Number(payload.x_max)
        if (!isFinite(x0) || !isFinite(x1)) { x0 = 792.0; x1 = 798.0 }
        if (x1 < x0) { var tmp = x0; x0 = x1; x1 = tmp }
        if (x1 === x0) { x1 = x0 + 1.0 }
        // если диапазон близок к "792..798", снапим к шагу 0.5, чтобы ось была ровная как на приборе
        if (Math.abs((x1 - x0) - 6.0) < 1.0) {
            x0 = Math.round(x0 * 2.0) / 2.0
            x1 = Math.round(x1 * 2.0) / 2.0
        }
        // обновляем ось X (тик 0.5 остается в ValueAxis)
        irAxisX.min = x0
        irAxisX.max = x1
        irAxisX.tickAnchor = x0
        var n = ys.length
        var dx = (n > 1) ? ((x1 - x0) / (n - 1)) : 0.0

        // Ось Y по данным (принудительно приводим к Number, т.к. элементы могут быть QVariant)
        var minY = Number(ys[0])
        var maxY = Number(ys[0])
        for (var j = 1; j < n; j++) {
            var yv = Number(ys[j])
            if (isNaN(yv)) continue
            if (yv < minY) minY = yv
            if (yv > maxY) maxY = yv
        }
        if (minY === maxY) { maxY = minY + 1 }
        var rangeY = maxY - minY
        var padY = rangeY * 0.05
        if (padY < 0.1) padY = 0.1
        irAxisY.min = minY - padY
        irAxisY.max = maxY + padY

        // QtGraphs: используем API XYSeries
        try {
            if (splineSeries.clear) splineSeries.clear()
        } catch (e) {
            console.log("[IR] Clinicalmode: splineSeries.clear() failed:", e)
        }

        var added = 0
        for (var i = 0; i < n; i++) {
            var x = x0 + dx * i
            var y = Number(ys[i])
            if (isNaN(x) || isNaN(y)) continue
            try {
                if (splineSeries.append) {
                    splineSeries.append(x, y)
                    added++
                }
            } catch (e2) {
                console.log("[IR] Clinicalmode: append failed at", i, x, y, e2)
            }
        }

        // Две "палки" (вертикальные маркеры) из метаданных:
        // - res_freq = регистры 409-410
        // - freq     = регистры 411-412
        var resX = Number(payload.res_freq)
        var freqX = Number(payload.freq)
        var yLo = irAxisY.min
        var yHi = irAxisY.max
        var xMin = irAxisX.min
        var xMax = irAxisX.max
        // пунктир делаем набором коротких сегментов (QtGraphs LineSeries не умеет DashLine)
        root._updateDashedVerticalMarker(spline.resMarkerSegments, resX, yLo, yHi, xMin, xMax, "res")
        root._updateDashedVerticalMarker(spline.freqMarkerSegments, freqX, yLo, yHi, xMin, xMax, "freq")

        var lastNonZero = -1
        for (var k = n - 1; k >= 0; k--) {
            if (Number(ys[k]) !== 0) { lastNonZero = k; break }
        }
        var xLastNonZero = (lastNonZero >= 0) ? (x0 + dx * lastNonZero) : null
        console.log("[IR] Clinicalmode: n=", n, "dx=", dx, "points added =", added, "x0=", x0, "x_last=", (x0 + dx * (n - 1)),
                    "axisY=", (minY - padY), (maxY + padY),
                    "res_freq=", resX, "freq=", freqX,
                    "lastNonZeroIdx=", lastNonZero, "xLastNonZero=", xLastNonZero,
                    "tail=", ys.slice(Math.max(0, n - 6)))
    }

    // Retry: если IR не пришел (адресация/устройство занято) — будем аккуратно запрашивать
    Timer {
        id: irRetryTimer
        interval: 2000
        repeat: true
        running: root.cachedIsConnected
        onTriggered: {
            if (modbusManager) modbusManager.requestIrSpectrum()
        }
    }

    Connections {
        target: modbusManager
        function onIrSpectrumChanged(payload) {
            root.updateIrGraph(payload)
        }
    }

    // При подключении дергаем один раз IR спектр
    Connections {
        target: modbusManager
        function onConnectionStatusChanged(connected) {
            root.cachedIsConnected = connected
            if (connected && modbusManager) {
                Qt.callLater(function() { modbusManager.requestIrSpectrum() })
            }
        }
    }
    
    // Инициализируем кэш после загрузки компонента асинхронно
    Component.onCompleted: {
        // Устанавливаем начальное значение асинхронно, чтобы не блокировать рендеринг
        Qt.callLater(function() {
            if (modbusManager) {
                root.cachedIsConnected = modbusManager.isConnected
            }
        })
    }

    Rectangle {
        id: rectangle
        anchors.fill: parent
        color: "#ffffff"

    }

    Rectangle {
        id: rectangle1
        anchors.left: rectangle2.right
        anchors.leftMargin: 17
        anchors.right: valuesPanel.right
        anchors.rightMargin: 0
        anchors.top: parent.top
        anchors.topMargin: 28
        height: 37
        color: "#979797"
        radius: 8
        border.width: 0
        Text {
            id: text1
            anchors.left: parent.left
            anchors.leftMargin: 8
            anchors.verticalCenter: parent.verticalCenter
            width: 71
            height: 29
            color: "#ffffff"
            text: qsTr("Status:")
            font.pixelSize: 24
            horizontalAlignment: Text.AlignLeft
            textFormat: Text.AutoText
            scale: 1
            transformOrigin: Item.Center
        }

        Button {
            id: connectionButton
            anchors.right: parent.right
            anchors.rightMargin: 6
            anchors.verticalCenter: parent.verticalCenter
            width: 148
            height: 30
            
            // Привязываем текст к тексту кнопки подключения из modbusManager (только "Connect" или "Disconnect")
            text: modbusManager ? modbusManager.connectionButtonText : qsTr("Connect")
            font.pointSize: 20
            font.weight: Font.Normal
            
            // Делаем кнопку кликабельной и видимой
            enabled: true
            hoverEnabled: true
            
            // Стилизация кнопки с видимым фоном
            // Используем кэшированное значение для мгновенного доступа без синхронных операций
            background: Rectangle {
                color: connectionButton.hovered ? "#888888" : (root.cachedIsConnected ? "#2d5a2d" : "#7a7a7a")
                border.color: root.cachedIsConnected ? "#00ff00" : "#888888"
                border.width: 1
                radius: 4
            }
            
            // Стилизация текста
            contentItem: Text {
                text: connectionButton.text
                font: connectionButton.font
                color: root.cachedIsConnected ? "#00ff00" : "#ffffff"
                horizontalAlignment: Text.AlignHCenter
                verticalAlignment: Text.AlignVCenter
                elide: Text.ElideRight
            }
            
            // Обработчик клика
            onClicked: {
                console.log("Кнопка подключения нажата, текущий статус:", root.cachedIsConnected)
                if (modbusManager) {
                    modbusManager.toggleConnection()
                } else {
                    console.log("ОШИБКА: modbusManager не доступен!")
                }
            }
        }

        Label {
            id: label
            anchors.left: text1.right
            anchors.leftMargin: 6
            anchors.verticalCenter: parent.verticalCenter
            width: 435
            height: 30
            visible: true
            color: "#ffffff"
            text: qsTr("Label")
            layer.enabled: false
            font.styleName: "Regular"
            font.pointSize: 24
            font.capitalization: Font.MixedCase
            clip: false
        }
    }

    Rectangle {
        id: rectangle3
        anchors.right: parent.right
        anchors.rightMargin: 18
        anchors.top: spline.bottom
        anchors.topMargin: 19
        width: 480
        height: 33
        color: "#979797"

        Text {
            id: text3
            anchors.centerIn: parent
            color: "#ffffff"
            text: qsTr("NMR spectrum ")
            font.pixelSize: 20
        }
    }

    Rectangle {
        id: rectangle4
        anchors.right: parent.right
        anchors.rightMargin: 20
        anchors.top: spline1.bottom
        anchors.topMargin: 19
        width: 478
        height: 33
        color: "#979797"

        Text {
            id: text4
            anchors.centerIn: parent
            color: "#ffffff"
            text: qsTr("IR spectrum ")
            font.pixelSize: 20
        }
    }

    Rectangle {
        id: rectangle5
        anchors.right: parent.right
        anchors.rightMargin: 20
        anchors.top: parent.top
        anchors.topMargin: 27
        width: 478
        height: 33
        color: "#979797"
        Text {
            id: text5
            anchors.centerIn: parent
            color: "#ffffff"
            text: qsTr("PXE Chart")
            font.pixelSize: 20
        }
    }

    Item {
        id: clinicalModeRoot
        anchors.fill: parent

        // Получаем ссылку на главное окно для доступа к функции смены экрана
        property var mainWindow: ApplicationWindow.window ? ApplicationWindow.window : null

        Button {
            id: button
            anchors.left: parent.left
            anchors.leftMargin: 25
            anchors.top: parent.top
            anchors.topMargin: 78
            width: 160
            height: 70
            text: qsTr("Mode")
            font.pointSize: 24

            // Custom background
            background: Rectangle {
                color: button.down ? "#979797" : "#979797"
            }

            onClicked: {
                // Возвращаемся на Screen01
                if (mainWindow) {
                    mainWindow.changeScreen("Screen01");
                }
            }
        }

        // Другие элементы вашего Clinicalmode.qml...
    }

    Rectangle {
        id: rectangle2
        anchors.left: parent.left
        anchors.leftMargin: 25
        anchors.top: parent.top
        anchors.topMargin: 27
        width: 160
        height: 59
        color: "#545454"
        Text {
            id: text2
            anchors.centerIn: parent
            color: "#fafafa"
            text: qsTr("Clinical")
            font.pixelSize: 22
        }
    }


    // Данные для меню
    QtObject {
        id: menuData
        property var groups: ({
            "1 Manual Mode": { 
                label: "1 Manual Mode", 
                params: ["External Relays", "Valves and Fans", "Power Supply", "PID Controller", "Water Chiller", "Alicats", "Vacuum Controller", "Laser"] 
            },
            "2 Advanced Programs List": { 
                label: "2 Advanced Programs List", 
                params: ["Measure IR Hot Field On", "Measure IR Hot Field Off", "Acquire Hot Cell Mag Off", "Measure IR Cold", "Acquire Current HP 129XE Signal", "Automated Current Sweep On HP 129XE", "Automated Current Sweep On Water", "Acquire Reference 1H Signal", "Timed Polarization Build Up", "Timed Polarization Decay", "SEOP Cell QA Study", "SEOP Initialization", "Laser Reinitialization", "SEOP Process", "HP XE Eject", "HP XE Flow", "Clinical Sequence", "Purge Cycle Initialization", "Restore Default State"] 
            },
            "3 SEOP Parameters": { 
                label: "3 SEOP Parameters", 
                params: ["Laser Max Temp", "T Laser Max", "Laser Min Temp", "T Laser Min", "SEOP Cell Max Temp", "T Cell Max", "SEOP Cell Min Temp", "T Cell Min", "Set Temp During SEOP Ramp", "T Ramp", "SEOP Temp", "T SEOP", "Cell Refill Temp", "T Refill", "SEOP Cell Temp Ramp Duration", "SEOP Loop Time", "T SEOP LP"] 
            },
            "4 Calculated Parameters": { 
                label: "4 Calculated Parameters", 
                params: ["SEOP Process Duration", "Time SEOP", "Laser Max Output Power", "P Laser Max", "Laser PSU Max Current", "I Laser Max", "XE Concentration Gas Mixture", "Conc XE MM", "Water Proton Concentration", "Conc 1H M"] 
            },
            "5 Measured Parameters": { 
                label: "5 Measured Parameters", 
                params: ["Electron Polarization", "PRB", "129XE Polarization", "PXE", "Buildup Rate", "G SEOP", "HP 129XE T1", "T1"] 
            },
            "6 Additional Parameters": { 
                label: "6 Additional Parameters", 
                params: ["Error Bar For Electron Polarization", "PRB ERR", "Error Bar For 129XE Polarization", "PXE ERR", "Error Bar For Buildup Rate", "G SEOP ERR", "Fitted 129XE Polarization Max", "PXE Max", "Fitted 129XE Polarization Max Error Bar", "PXE Max ERR", "HP 129XE T1", "T1 ERR", "Current IR Signal", "IR Hot Field On", "Cold Cell IR Signal", "IR Cold", "Hot Cell IR Signal", "IR Hot Field Off", "Water 1H NMR Ref Signal", "S 1H"] 
            },
            "7 System Settings": { 
                label: "7 System Settings", 
                params: ["Current Datetime", "Driver N", "Language", "Setpoints Save Load", "Setpoints Reset", "Show Hidden Params", "Beep Mode", "Switchboard State", "Fault Code", "Fault Str", "Test"] 
            },
            "8 Archives": { 
                label: "8 Archives", 
                params: ["Archive View", "Archive To USB", "Archive Reset", "Archive Period", "Archive Period Emergency", "Archive Period Stop", "Archives Save To USB"] 
            }
        })
        
        // Данные о параметрах (упрощенная версия, можно расширить)
        property var params: ({
            "External Relays": { id: 101, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Valves and Fans": { id: 110, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Power Supply": { id: 107, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "PID Controller": { id: 104, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Water Chiller": { id: 109, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Alicats": { id: 105, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Vacuum Controller": { id: 108, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" },
            "Laser": { id: 106, type: "CMD", units: "", defaultValue: "", min: "", max: "", dtype: "DT_NONE" }
        })
    }
    
    // Состояние для отслеживания раскрытых групп и активного параметра
    property string expandedMenuItem: ""
    property string activeParam: ""
    property string activeParamGroup: ""

    // При смене активного параметра выключаем опрос реле/клапанов/вентиляторов/Power Supply, если закрываем соответствующие меню
    onActiveParamChanged: {
        if (modbusManager) {
            if (activeParam !== "External Relays") {
                modbusManager.disableRelayPolling()
            }
            if (activeParam !== "Valves and Fans") {
                modbusManager.disableValvePolling()
                modbusManager.disableFanPolling()
            }
            if (activeParam !== "Power Supply") {
                modbusManager.disablePowerSupplyPolling()
            }
            if (activeParam !== "PID Controller") {
                modbusManager.disablePIDControllerPolling()
            }
            if (activeParam !== "Water Chiller") {
                modbusManager.disableWaterChillerPolling()
            }
            if (activeParam !== "Alicats") {
                modbusManager.disableAlicatsPolling()
            }
            if (activeParam !== "Vacuum Controller") {
                modbusManager.disableVacuumControllerPolling()
            }
            if (activeParam !== "Laser") {
                modbusManager.disableLaserPolling()
                laserGrid.visible = false
            }
            // При изменении активного параметра отключаем опрос SEOP Parameters
            modbusManager.disableSEOPParametersPolling()
            seopParametersGrid.visible = false
            // При изменении активного параметра отключаем опрос Calculated Parameters
            modbusManager.disableCalculatedParametersPolling()
            calculatedParametersGrid.visible = false
            // При изменении активного параметра отключаем опрос Measured Parameters и Additional Parameters
            modbusManager.disableMeasuredParametersPolling()
            modbusManager.disableAdditionalParametersPolling()
            measuredParametersGrid.visible = false
        }
    }

    // Область для отображения информации о параметре (справа от sidebar)
    Rectangle {
        id: infoPanel
        anchors.left: sidebar.right
        anchors.leftMargin: 15
        anchors.top: rectangle2.bottom
        anchors.topMargin: 59
        anchors.bottom: parent.bottom
        anchors.bottomMargin: 5
        width: 500
        color: "#f5f5f5"
        border.color: "#d3d3d3"
        border.width: 1
        radius: 8

        Column {
            anchors.fill: parent
            anchors.margins: 16
            spacing: 12

            Text {
                id: infoTitle
                width: parent.width
                font.pixelSize: 18
                font.bold: true
                color: "#000000"
                text: "Select a parameter"
            }

            Text {
                id: infoSubtitle
                width: parent.width
                font.pixelSize: 12
                color: "#666666"
                text: "no item selected"
            }

            Rectangle {
                width: parent.width
                height: 1
                color: "#d3d3d3"
            }

            ScrollView {
                width: parent.width
                height: parent.height - infoTitle.height - infoSubtitle.height - 40
                clip: true

                Column {
                    width: infoPanel.width - 32
                    spacing: 8

                    Text {
                        id: infoContent
                        width: parent.width
                        wrapMode: Text.WordWrap
                        font.pixelSize: 13
                        color: "#000000"
                        text: "Use the menu on the left to open groups and parameters."
                    }

                    Grid {
                        id: paramGrid
                        width: parent.width
                        columns: 2
                        columnSpacing: 16
                        rowSpacing: 8
                        visible: false

                        Text { text: "ID:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramId; text: ""; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Type:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramType; text: ""; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Units:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramUnits; text: "—"; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Default:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramDefault; text: "—"; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Min:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramMin; text: "—"; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Max:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramMax; text: "—"; font.pixelSize: 12; color: "#000000" }
                        Text { text: "Data Type:"; font.pixelSize: 12; color: "#666666" }
                        Text { id: paramDtype; text: "—"; font.pixelSize: 12; color: "#000000" }
                    }

                    // Таблица реле для External Relays (в стиле paramGrid с кнопками on/off справа)
                    Column {
                        id: relayTableGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Water Chiller
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water Chiller:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayWaterChiller
                                    width: 80
                                    height: 28
                                    text: relayWaterChiller.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayWaterChiller.checked ? relayWaterChiller.pressedColor : relayWaterChiller.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setWaterChiller(relayWaterChiller.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onWaterChillerStateChanged(state) {
                                            if (relayWaterChiller.checked !== state) relayWaterChiller.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Magnet PSU
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Magnet PSU:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayMagnetPSU
                                    width: 80
                                    height: 28
                                    text: relayMagnetPSU.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayMagnetPSU.checked ? relayMagnetPSU.pressedColor : relayMagnetPSU.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setMagnetPSU(relayMagnetPSU.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onMagnetPSUStateChanged(state) {
                                            if (relayMagnetPSU.checked !== state) relayMagnetPSU.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser PSU:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayLaserPSU
                                    width: 80
                                    height: 28
                                    text: relayLaserPSU.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayLaserPSU.checked ? relayLaserPSU.pressedColor : relayLaserPSU.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setLaserPSU(relayLaserPSU.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onLaserPSUStateChanged(state) {
                                            if (relayLaserPSU.checked !== state) relayLaserPSU.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Vacuum Pump
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Vacuum Pump:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayVacuumPump
                                    width: 80
                                    height: 28
                                    text: relayVacuumPump.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayVacuumPump.checked ? relayVacuumPump.pressedColor : relayVacuumPump.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setVacuumPump(relayVacuumPump.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onVacuumPumpStateChanged(state) {
                                            if (relayVacuumPump.checked !== state) relayVacuumPump.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Vacuum Gauge
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Vacuum Gauge:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayVacuumGauge
                                    width: 80
                                    height: 28
                                    text: relayVacuumGauge.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayVacuumGauge.checked ? relayVacuumGauge.pressedColor : relayVacuumGauge.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setVacuumGauge(relayVacuumGauge.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onVacuumGaugeStateChanged(state) {
                                            if (relayVacuumGauge.checked !== state) relayVacuumGauge.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // PID Controller
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "PID Controller:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: relayPIDController
                                    width: 80
                                    height: 28
                                    text: relayPIDController.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: relayPIDController.checked ? relayPIDController.pressedColor : relayPIDController.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setPIDController(relayPIDController.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onPidControllerStateChanged(state) {
                                            if (relayPIDController.checked !== state) relayPIDController.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                    }

                    // Таблица клапанов и вентиляторов для Valves and Fans (в стиле paramGrid с кнопками on/off справа)
                    Column {
                        id: valvesFansTableGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Valves (X6-X12)
                        Text {
                            text: "Valves:"
                            font.pixelSize: 12
                            font.bold: true
                            color: "#666666"
                            width: parent.width
                            padding: 4
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // X6
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X6:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX6
                                    width: 80
                                    height: 28
                                    text: valveX6.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX6.checked ? valveX6.pressedColor : valveX6.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(5, valveX6.checked)  // valveIndex 5 = X6
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 5 && valveX6.checked !== state) valveX6.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X7
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X7:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX7
                                    width: 80
                                    height: 28
                                    text: valveX7.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX7.checked ? valveX7.pressedColor : valveX7.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(6, valveX7.checked)  // valveIndex 6 = X7
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 6 && valveX7.checked !== state) valveX7.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X8
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X8:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX8
                                    width: 80
                                    height: 28
                                    text: valveX8.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX8.checked ? valveX8.pressedColor : valveX8.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(7, valveX8.checked)  // valveIndex 7 = X8
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 7 && valveX8.checked !== state) valveX8.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X9
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X9:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX9
                                    width: 80
                                    height: 28
                                    text: valveX9.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX9.checked ? valveX9.pressedColor : valveX9.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(8, valveX9.checked)  // valveIndex 8 = X9
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 8 && valveX9.checked !== state) valveX9.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X10
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X10:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX10
                                    width: 80
                                    height: 28
                                    text: valveX10.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX10.checked ? valveX10.pressedColor : valveX10.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(9, valveX10.checked)  // valveIndex 9 = X10
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 9 && valveX10.checked !== state) valveX10.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X11
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X11:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX11
                                    width: 80
                                    height: 28
                                    text: valveX11.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX11.checked ? valveX11.pressedColor : valveX11.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(10, valveX11.checked)  // valveIndex 10 = X11
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 10 && valveX11.checked !== state) valveX11.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // X12
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "X12:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: valveX12
                                    width: 80
                                    height: 28
                                    text: valveX12.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: valveX12.checked ? valveX12.pressedColor : valveX12.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setValve(11, valveX12.checked)  // valveIndex 11 = X12
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onValveStateChanged(valveIndex, state) {
                                            if (valveIndex === 11 && valveX12.checked !== state) valveX12.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // Fans (Inlet, Outlet, OpCell, Laser)
                        Text {
                            text: "Fans:"
                            font.pixelSize: 12
                            font.bold: true
                            color: "#666666"
                            width: parent.width
                            padding: 4
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // Inlet Fan 1
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Inlet Fan 1:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanInlet1
                                    width: 80
                                    height: 28
                                    text: fanInlet1.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanInlet1.checked ? fanInlet1.pressedColor : fanInlet1.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(0, fanInlet1.checked)  // fanIndex 0 = Inlet Fan 1
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 0 && fanInlet1.checked !== state) fanInlet1.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Inlet Fan 2
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Inlet Fan 2:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanInlet2
                                    width: 80
                                    height: 28
                                    text: fanInlet2.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanInlet2.checked ? fanInlet2.pressedColor : fanInlet2.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(1, fanInlet2.checked)  // fanIndex 1 = Inlet Fan 2
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 1 && fanInlet2.checked !== state) fanInlet2.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Inlet Fan 3
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Inlet Fan 3:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanInlet3
                                    width: 80
                                    height: 28
                                    text: fanInlet3.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanInlet3.checked ? fanInlet3.pressedColor : fanInlet3.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(2, fanInlet3.checked)  // fanIndex 2 = Inlet Fan 3
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 2 && fanInlet3.checked !== state) fanInlet3.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Inlet Fan 4
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Inlet Fan 4:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanInlet4
                                    width: 80
                                    height: 28
                                    text: fanInlet4.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanInlet4.checked ? fanInlet4.pressedColor : fanInlet4.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(3, fanInlet4.checked)  // fanIndex 3 = Inlet Fan 4
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 3 && fanInlet4.checked !== state) fanInlet4.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Outlet Fan 1
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Outlet Fan 1:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOutlet1
                                    width: 80
                                    height: 28
                                    text: fanOutlet1.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOutlet1.checked ? fanOutlet1.pressedColor : fanOutlet1.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(4, fanOutlet1.checked)  // fanIndex 4 = Outlet Fan 1
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 4 && fanOutlet1.checked !== state) fanOutlet1.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Outlet Fan 2
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Outlet Fan 2:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOutlet2
                                    width: 80
                                    height: 28
                                    text: fanOutlet2.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOutlet2.checked ? fanOutlet2.pressedColor : fanOutlet2.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(5, fanOutlet2.checked)  // fanIndex 5 = Outlet Fan 2
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 5 && fanOutlet2.checked !== state) fanOutlet2.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // OpCell Fan 1
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "OpCell Fan 1:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOpCell1
                                    width: 80
                                    height: 28
                                    text: fanOpCell1.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOpCell1.checked ? fanOpCell1.pressedColor : fanOpCell1.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(6, fanOpCell1.checked)  // fanIndex 6 = OpCell Fan 1
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 6 && fanOpCell1.checked !== state) fanOpCell1.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // OpCell Fan 2
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "OpCell Fan 2:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOpCell2
                                    width: 80
                                    height: 28
                                    text: fanOpCell2.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOpCell2.checked ? fanOpCell2.pressedColor : fanOpCell2.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(7, fanOpCell2.checked)  // fanIndex 7 = OpCell Fan 2
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 7 && fanOpCell2.checked !== state) fanOpCell2.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // OpCell Fan 3
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "OpCell Fan 3:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOpCell3
                                    width: 80
                                    height: 28
                                    text: fanOpCell3.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOpCell3.checked ? fanOpCell3.pressedColor : fanOpCell3.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(8, fanOpCell3.checked)  // fanIndex 8 = OpCell Fan 3
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 8 && fanOpCell3.checked !== state) fanOpCell3.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // OpCell Fan 4
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "OpCell Fan 4:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanOpCell4
                                    width: 80
                                    height: 28
                                    text: fanOpCell4.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanOpCell4.checked ? fanOpCell4.pressedColor : fanOpCell4.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(9, fanOpCell4.checked)  // fanIndex 9 = OpCell Fan 4
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 9 && fanOpCell4.checked !== state) fanOpCell4.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser Fan
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser Fan:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: fanLaser
                                    width: 80
                                    height: 28
                                    text: fanLaser.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: fanLaser.checked ? fanLaser.pressedColor : fanLaser.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setFan(10, fanLaser.checked)  // fanIndex 10 = Laser Fan
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onFanStateChanged(fanIndex, state) {
                                            if (fanIndex === 10 && fanLaser.checked !== state) fanLaser.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                    }

                    // Таблица Power Supply для Power Supply меню
                    Column {
                        id: powerSupplyGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Laser PSU
                        Text {
                            text: "Laser PSU:"
                            font.pixelSize: 12
                            font.bold: true
                            color: "#666666"
                            width: parent.width
                            padding: 4
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // Laser PSU - Voltage Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Voltage Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: laserVoltageValue
                                text: "0.00 V"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU - Voltage Setpoint
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Voltage Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: laserVoltageSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "V"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 120 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU - Current Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Current Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: laserCurrentValue
                                text: "0.00 A"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU - Current Setpoint
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Current Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: laserCurrentSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "A"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 120 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU - On/Off
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Power:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: laserPSUPower
                                    width: 80
                                    height: 28
                                    text: laserPSUPower.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: laserPSUPower.checked ? laserPSUPower.pressedColor : laserPSUPower.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setLaserPSUPower(laserPSUPower.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onLaserPSUStateChanged(state) {
                                            if (laserPSUPower.checked !== state) laserPSUPower.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // Magnet PSU
                        Text {
                            text: "Magnet PSU:"
                            font.pixelSize: 12
                            font.bold: true
                            color: "#666666"
                            width: parent.width
                            padding: 4
                        }
                        Rectangle { width: parent.width; height: 1; color: "#d0d0d0" }

                        // Magnet PSU - Voltage Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Voltage Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: magnetVoltageValue
                                text: "0.00 V"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Magnet PSU - Voltage Setpoint
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Voltage Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: magnetVoltageSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "V"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 120 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Magnet PSU - Current Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Current Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: magnetCurrentValue
                                text: "0.00 A"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Magnet PSU - Current Setpoint
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Current Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: magnetCurrentSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "A"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 120 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Magnet PSU - On/Off
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Power:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: magnetPSUPower
                                    width: 80
                                    height: 28
                                    text: magnetPSUPower.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: magnetPSUPower.checked ? magnetPSUPower.pressedColor : magnetPSUPower.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setMagnetPSUPower(magnetPSUPower.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onMagnetPSUStateChanged(state) {
                                            if (magnetPSUPower.checked !== state) magnetPSUPower.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }

                        // Connections для обновления значений Laser PSU
                        Connections {
                            target: modbusManager
                            function onLaserPSUVoltageChanged(value) {
                                laserVoltageValue.text = value.toFixed(2) + " V"
                            }
                            function onLaserPSUCurrentChanged(value) {
                                laserCurrentValue.text = value.toFixed(2) + " A"
                            }
                            function onLaserPSUVoltageSetpointChanged(value) {
                                if (!laserVoltageSetpoint.activeFocus) {
                                    laserVoltageSetpoint.text = value.toFixed(2)
                                }
                            }
                            function onLaserPSUSetpointChanged(value) {
                                if (!laserCurrentSetpoint.activeFocus) {
                                    laserCurrentSetpoint.text = value.toFixed(2)
                                }
                            }
                        }

                        // Connections для обновления значений Magnet PSU
                        Connections {
                            target: modbusManager
                            function onMagnetPSUVoltageChanged(value) {
                                magnetVoltageValue.text = value.toFixed(2) + " V"
                            }
                            function onMagnetPSUCurrentChanged(value) {
                                magnetCurrentValue.text = value.toFixed(2) + " A"
                            }
                            function onMagnetPSUVoltageSetpointChanged(value) {
                                if (!magnetVoltageSetpoint.activeFocus) {
                                    magnetVoltageSetpoint.text = value.toFixed(2)
                                }
                            }
                            function onMagnetPSUSetpointChanged(value) {
                                if (!magnetCurrentSetpoint.activeFocus) {
                                    magnetCurrentSetpoint.text = value.toFixed(2)
                                }
                            }
                        }
                    }

                    // Таблица PID Controller для PID Controller меню
                    Column {
                        id: pidControllerGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Temperature Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Temperature Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: pidControllerTemperatureValue
                                text: "0.00 °C"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Temperature Setpoint
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Temperature Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: pidControllerSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increasePIDControllerTemperature()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreasePIDControllerTemperature()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // On/Off
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Power:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Button {
                                    id: pidControllerPower
                                    width: 80
                                    height: 28
                                    text: pidControllerPower.checked ? "ON" : "OFF"
                                    font.pixelSize: 11
                                    checkable: true
                                    property color normalColor: "#979797"
                                    property color pressedColor: "#38691e"
                                    background: Rectangle {
                                        color: pidControllerPower.checked ? pidControllerPower.pressedColor : pidControllerPower.normalColor
                                        radius: 3
                                    }
                                    onClicked: {
                                        if (modbusManager) modbusManager.setPIDControllerPower(pidControllerPower.checked)
                                    }
                                    Connections {
                                        target: modbusManager
                                        function onPidControllerStateChanged(state) {
                                            if (pidControllerPower.checked !== state) pidControllerPower.checked = state
                                        }
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 80 - 16; height: 0 }
                        }

                        // Connections для обновления значений PID Controller
                        Connections {
                            target: modbusManager
                            function onPidControllerTemperatureChanged(value) {
                                pidControllerTemperatureValue.text = value.toFixed(2) + " °C"
                            }
                            function onPidControllerSetpointChanged(value) {
                                if (!pidControllerSetpoint.activeFocus) {
                                    pidControllerSetpoint.text = value.toFixed(2)
                                }
                            }
                        }
                    }

                    // Таблица Alicats для Alicats меню
                    Column {
                        id: alicatsGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Alicat 1 Xenon - Value Torr
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Alicat 1 Xenon Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: xenonPressure
                                text: "0.00 Torr"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Alicat 1 Xenon - Setpoint Torr
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Alicat 1 Xenon Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: xenonSetpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "Torr"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseXenonSetpoint()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseXenonSetpoint()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Alicat 2 N2 - Value Torr
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Alicat 2 N2 Value:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: n2Pressure
                                text: "0.00 Torr"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Alicat 2 N2 - Setpoint Torr
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Alicat 2 N2 Setpoint:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: n2Setpoint
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "Torr"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseN2Setpoint()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseN2Setpoint()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 180 - 16; height: 0 }
                        }

                        // Connections для обновления значений Alicats
                        Connections {
                            target: modbusManager
                            function onXenonPressureChanged(value) {
                                xenonPressure.text = value.toFixed(2) + " Torr"
                            }
                            function onXenonSetpointChanged(value) {
                                if (!xenonSetpoint.activeFocus) {
                                    xenonSetpoint.text = value.toFixed(2)
                                }
                            }
                            function onN2PressureChanged(value) {
                                n2Pressure.text = value.toFixed(2) + " Torr"
                            }
                            function onN2SetpointChanged(value) {
                                if (!n2Setpoint.activeFocus) {
                                    n2Setpoint.text = value.toFixed(2)
                                }
                            }
                        }
                    }

                    // Таблица Vacuum Controller для Vacuum Controller меню
                    Column {
                        id: vacuumControllerGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Vacuum Pressure Value
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Vacuum Pressure:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 120 }
                            Text { 
                                id: vacuumControllerPressure
                                text: "0.00 mTorr"
                                font.pixelSize: 12
                                color: "#000000"
                                anchors.verticalCenter: parent.verticalCenter
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 120 - 100 - 16; height: 0 }
                        }

                        // Connections для обновления значений Vacuum Controller
                        Connections {
                            target: modbusManager
                            function onVacuumControllerPressureChanged(value) {
                                console.log("Vacuum Controller pressure changed:", value)
                                vacuumControllerPressure.text = value.toFixed(2) + " mTorr"
                            }
                        }
                    }

                    // Таблица SEOP Parameters для "3 SEOP Parameters" меню
                    Column {
                        id: seopParametersGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Laser Max Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser Max Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopLaserMaxTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPLaserMaxTempValue(val)
                                            modbusManager.setSEOPLaserMaxTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPLaserMaxTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPLaserMaxTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser Min Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser Min Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopLaserMinTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPLaserMinTempValue(val)
                                            modbusManager.setSEOPLaserMinTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPLaserMinTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPLaserMinTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP Cell Max Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP Cell Max Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopCellMaxTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPCellMaxTempValue(val)
                                            modbusManager.setSEOPCellMaxTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPCellMaxTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPCellMaxTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP Cell Min Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP Cell Min Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopCellMinTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPCellMinTempValue(val)
                                            modbusManager.setSEOPCellMinTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPCellMinTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPCellMinTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP Ramp Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP Ramp Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopRampTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPRampTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPRampTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPTempValue(val)
                                            modbusManager.setSEOPTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Cell Refill Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Cell Refill Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopCellRefillTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPCellRefillTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPCellRefillTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP loop time
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP loop time:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopLoopTime
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPLoopTimeValue(val)
                                            modbusManager.setSEOPLoopTime(val)
                                        }
                                    }
                                }
                                Text { text: "s"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPLoopTime()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPLoopTime()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // SEOP process duration (m:s)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "SEOP process duration:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopProcessDuration
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0:00"
                                    onEditingFinished: {
                                        // Парсим формат m:s (например, "5:30" -> 330 секунд)
                                        var parts = text.split(":")
                                        if (parts.length === 2 && modbusManager) {
                                            var minutes = parseInt(parts[0]) || 0
                                            var seconds = parseInt(parts[1]) || 0
                                            var totalSeconds = minutes * 60 + seconds
                                            modbusManager.setSEOPProcessDurationValue(totalSeconds)
                                            modbusManager.setSEOPProcessDuration(totalSeconds)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPProcessDuration()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPProcessDuration()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser Max Output Power
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser Max Output Power:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopLaserMaxOutputPower
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPLaserMaxOutputPowerValue(val)
                                            modbusManager.setSEOPLaserMaxOutputPower(val)
                                        }
                                    }
                                }
                                Text { text: "W"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPLaserMaxOutputPower()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPLaserMaxOutputPower()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Laser PSU Max Current
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Laser PSU Max Current:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopLaserPSUMaxCurrent
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPLaserPSUMaxCurrentValue(val)
                                            modbusManager.setSEOPLaserPSUMaxCurrent(val)
                                        }
                                    }
                                }
                                Text { text: "A"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPLaserPSUMaxCurrent()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPLaserPSUMaxCurrent()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Water Chiller Max Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water Chiller Max Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopWaterChillerMaxTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPWaterChillerMaxTempValue(val)
                                            modbusManager.setSEOPWaterChillerMaxTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPWaterChillerMaxTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPWaterChillerMaxTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Water Chiller Min Temp
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water Chiller Min Temp:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopWaterChillerMinTemp
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPWaterChillerMinTempValue(val)
                                            modbusManager.setSEOPWaterChillerMinTemp(val)
                                        }
                                    }
                                }
                                Text { text: "°C"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPWaterChillerMinTemp()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPWaterChillerMinTemp()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // 129Xe concentration of the gas mixture
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "129Xe concentration of the gas mixture:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopXeConcentration
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPXeConcentrationValue(val)
                                            modbusManager.setSEOPXeConcentration(val)
                                        }
                                    }
                                }
                                Text { text: "mMol"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPXeConcentration()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPXeConcentration()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Water Proton Concentration
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water Proton Concentration:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopWaterProtonConcentration
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPWaterProtonConcentrationValue(val)
                                            modbusManager.setSEOPWaterProtonConcentration(val)
                                        }
                                    }
                                }
                                Text { text: "Mol"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPWaterProtonConcentration()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPWaterProtonConcentration()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Cell number
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Cell number:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopCellNumber
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseInt(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPCellNumberValue(val)
                                            modbusManager.setSEOPCellNumber(val)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPCellNumber()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPCellNumber()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Refill cycle
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Refill cycle:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 150 }
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: seopRefillCycle
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseInt(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setSEOPRefillCycleValue(val)
                                            modbusManager.setSEOPRefillCycle(val)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseSEOPRefillCycle()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseSEOPRefillCycle()
                                    }
                                }
                            }
                            Rectangle { width: parent.width - parent.padding * 2 - 150 - 180 - 16; height: 0 }
                        }

                        // Connections для обновления значений SEOP Parameters
                        Connections {
                            target: modbusManager
                            function onSeopLaserMaxTempChanged(value) {
                                if (!seopLaserMaxTemp.activeFocus) {
                                    seopLaserMaxTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopLaserMinTempChanged(value) {
                                if (!seopLaserMinTemp.activeFocus) {
                                    seopLaserMinTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopCellMaxTempChanged(value) {
                                if (!seopCellMaxTemp.activeFocus) {
                                    seopCellMaxTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopCellMinTempChanged(value) {
                                if (!seopCellMinTemp.activeFocus) {
                                    seopCellMinTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopRampTempChanged(value) {
                                if (!seopRampTemp.activeFocus) {
                                    seopRampTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopTempChanged(value) {
                                if (!seopTemp.activeFocus) {
                                    seopTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopCellRefillTempChanged(value) {
                                if (!seopCellRefillTemp.activeFocus) {
                                    seopCellRefillTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopLoopTimeChanged(value) {
                                if (!seopLoopTime.activeFocus) {
                                    seopLoopTime.text = value.toFixed(0)
                                }
                            }
                            function onSeopProcessDurationChanged(value) {
                                if (!seopProcessDuration.activeFocus) {
                                    var minutes = Math.floor(value / 60)
                                    var seconds = Math.floor(value % 60)
                                    seopProcessDuration.text = minutes + ":" + (seconds < 10 ? "0" : "") + seconds
                                }
                            }
                            function onSeopCellNumberChanged(value) {
                                if (!seopCellNumber.activeFocus) {
                                    seopCellNumber.text = value.toString()
                                }
                            }
                            function onSeopRefillCycleChanged(value) {
                                if (!seopRefillCycle.activeFocus) {
                                    seopRefillCycle.text = value.toString()
                                }
                            }
                            function onSeopLaserMaxOutputPowerChanged(value) {
                                if (!seopLaserMaxOutputPower.activeFocus) {
                                    seopLaserMaxOutputPower.text = value.toFixed(2)
                                }
                            }
                            function onSeopLaserPSUMaxCurrentChanged(value) {
                                if (!seopLaserPSUMaxCurrent.activeFocus) {
                                    seopLaserPSUMaxCurrent.text = value.toFixed(2)
                                }
                            }
                            function onSeopWaterChillerMaxTempChanged(value) {
                                if (!seopWaterChillerMaxTemp.activeFocus) {
                                    seopWaterChillerMaxTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopWaterChillerMinTempChanged(value) {
                                if (!seopWaterChillerMinTemp.activeFocus) {
                                    seopWaterChillerMinTemp.text = value.toFixed(2)
                                }
                            }
                            function onSeopXeConcentrationChanged(value) {
                                if (!seopXeConcentration.activeFocus) {
                                    seopXeConcentration.text = value.toFixed(0)
                                }
                            }
                            function onSeopWaterProtonConcentrationChanged(value) {
                                if (!seopWaterProtonConcentration.activeFocus) {
                                    seopWaterProtonConcentration.text = value.toFixed(2)
                                }
                            }
                        }
                    }

                    // Таблица Calculated Parameters для "4 Calculated Parameters" меню
                    Column {
                        id: calculatedParametersGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Electron Polarization
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Electron Polarization:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedElectronPolarization
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // 129Xe Polarization
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "129Xe Polarization:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedXePolarization
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // The buildup rate
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "The buildup rate:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedBuildupRate
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "1/min"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Error bar for Electron Polarization
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Error bar for Electron Polarization:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedElectronPolarizationError
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Error bar for 129Xe Polarization
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Error bar for 129Xe Polarization:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedXePolarizationError
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Error bar for the buildup rate
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Error bar for the buildup rate:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedBuildupRateError
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "1/min"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Fitted 129Xe Polarization maximum
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Fitted 129Xe Polarization maximum:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedFittedXePolarizationMax
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Fitted 129Xe Polarization max error bar
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Fitted 129Xe Polarization max error bar:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedFittedXePolarizationMaxError
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "%"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // HP 129Xe T1
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "HP 129Xe T1:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedHPXeT1
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "min"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Error bar for 129Xe T1
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Error bar for 129Xe T1:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: calculatedHPXeT1Error
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0.00"
                                    verticalAlignment: Text.AlignVCenter
                                }
                                Text { text: "min"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                            }
                        }

                        // Connections для обновления значений Calculated Parameters
                        Connections {
                            target: modbusManager
                            function onCalculatedElectronPolarizationChanged(value) {
                                calculatedElectronPolarization.text = value.toFixed(2)
                            }
                            function onCalculatedXePolarizationChanged(value) {
                                calculatedXePolarization.text = value.toFixed(2)
                            }
                            function onCalculatedBuildupRateChanged(value) {
                                calculatedBuildupRate.text = value.toFixed(2)
                            }
                            function onCalculatedElectronPolarizationErrorChanged(value) {
                                calculatedElectronPolarizationError.text = value.toFixed(2)
                            }
                            function onCalculatedXePolarizationErrorChanged(value) {
                                calculatedXePolarizationError.text = value.toFixed(2)
                            }
                            function onCalculatedBuildupRateErrorChanged(value) {
                                calculatedBuildupRateError.text = value.toFixed(2)
                            }
                            function onCalculatedFittedXePolarizationMaxChanged(value) {
                                calculatedFittedXePolarizationMax.text = value.toFixed(2)
                            }
                            function onCalculatedFittedXePolarizationMaxErrorChanged(value) {
                                calculatedFittedXePolarizationMaxError.text = value.toFixed(2)
                            }
                            function onCalculatedHPXeT1Changed(value) {
                                calculatedHPXeT1.text = value.toFixed(2)
                            }
                            function onCalculatedHPXeT1ErrorChanged(value) {
                                calculatedHPXeT1Error.text = value.toFixed(2)
                            }
                        }
                    }

                    // Таблица Measured Parameters для "5 Measured Parameters" меню
                    Column {
                        id: measuredParametersGrid
                        width: parent.width
                        spacing: 0
                        visible: false

                        // Current IR Signal (только чтение)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Current IR Signal:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: measuredCurrentIRSignal
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0"
                                    verticalAlignment: Text.AlignVCenter
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Cold Cell IR Signal (чтение и запись)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Cold Cell IR Signal:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: measuredColdCellIRSignal
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setMeasuredColdCellIRSignalValue(val)
                                            modbusManager.setMeasuredColdCellIRSignal(val)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseMeasuredColdCellIRSignal()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseMeasuredColdCellIRSignal()
                                    }
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Hot Cell IR Signal (чтение и запись)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Hot Cell IR Signal:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: measuredHotCellIRSignal
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setMeasuredHotCellIRSignalValue(val)
                                            modbusManager.setMeasuredHotCellIRSignal(val)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseMeasuredHotCellIRSignal()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseMeasuredHotCellIRSignal()
                                    }
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Water 1H NMR Reference Signal (чтение и запись)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water 1H NMR Reference Signal:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: measuredWater1HNMRReferenceSignal
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setMeasuredWater1HNMRReferenceSignalValue(val)
                                            modbusManager.setMeasuredWater1HNMRReferenceSignal(val)
                                        }
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseMeasuredWater1HNMRReferenceSignal()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseMeasuredWater1HNMRReferenceSignal()
                                    }
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // Water T2 (чтение и запись)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "Water T2:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: measuredWaterT2
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setMeasuredWaterT2Value(val)
                                            modbusManager.setMeasuredWaterT2(val)
                                        }
                                    }
                                }
                                Text { text: "ms"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseMeasuredWaterT2()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseMeasuredWaterT2()
                                    }
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // HP 129Xe NMR Signal (только чтение)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "HP 129Xe NMR Signal:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: measuredHP129XeNMRSignal
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0"
                                    verticalAlignment: Text.AlignVCenter
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // HP 129Xe T2 (чтение и запись)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "HP 129Xe T2:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                TextField {
                                    id: measuredHP129XeT2
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    placeholderText: "0.00"
                                    onEditingFinished: {
                                        var val = parseFloat(text)
                                        if (!isNaN(val) && modbusManager) {
                                            modbusManager.setMeasuredHP129XeT2Value(val)
                                            modbusManager.setMeasuredHP129XeT2(val)
                                        }
                                    }
                                }
                                Text { text: "ms"; font.pixelSize: 11; color: "#666666"; anchors.verticalCenter: parent.verticalCenter }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▲"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.increaseMeasuredHP129XeT2()
                                    }
                                }
                                Button {
                                    width: 30
                                    height: 28
                                    text: "▼"
                                    font.pixelSize: 10
                                    onClicked: {
                                        if (modbusManager) modbusManager.decreaseMeasuredHP129XeT2()
                                    }
                                }
                            }
                        }
                        Rectangle { width: parent.width; height: 1; color: "#e0e0e0" }

                        // T2* correction factor (только чтение)
                        Row {
                            width: parent.width
                            spacing: 16
                            padding: 4
                            Text { text: "T2* correction factor:"; font.pixelSize: 12; color: "#666666"; anchors.verticalCenter: parent.verticalCenter; width: 200 }
                            Item { width: 20; height: 1 } // Spacer
                            Row {
                                anchors.verticalCenter: parent.verticalCenter
                                spacing: 8
                                Text {
                                    id: measuredT2CorrectionFactor
                                    width: 100
                                    height: 28
                                    font.pixelSize: 11
                                    color: "#000000"
                                    text: "0"
                                    verticalAlignment: Text.AlignVCenter
                                }
                            }
                        }

                        // Connections для обновления значений Measured Parameters
                        Connections {
                            target: modbusManager
                            function onMeasuredCurrentIRSignalChanged(value) {
                                measuredCurrentIRSignal.text = value.toFixed(0)
                            }
                            function onMeasuredColdCellIRSignalChanged(value) {
                                if (!measuredColdCellIRSignal.activeFocus) {
                                    measuredColdCellIRSignal.text = value.toFixed(0)
                                }
                            }
                            function onMeasuredHotCellIRSignalChanged(value) {
                                if (!measuredHotCellIRSignal.activeFocus) {
                                    measuredHotCellIRSignal.text = value.toFixed(0)
                                }
                            }
                            function onMeasuredWater1HNMRReferenceSignalChanged(value) {
                                if (!measuredWater1HNMRReferenceSignal.activeFocus) {
                                    measuredWater1HNMRReferenceSignal.text = value.toFixed(0)
                                }
                            }
                            function onMeasuredWaterT2Changed(value) {
                                if (!measuredWaterT2.activeFocus) {
                                    measuredWaterT2.text = value.toFixed(2)
                                }
                            }
                            function onMeasuredHP129XeNMRSignalChanged(value) {
                                measuredHP129XeNMRSignal.text = value.toFixed(0)
                            }
                            function onMeasuredHP129XeT2Changed(value) {
                                if (!measuredHP129XeT2.activeFocus) {
                                    measuredHP129XeT2.text = value.toFixed(2)
                                }
                            }
                            function onMeasuredT2CorrectionFactorChanged(value) {
                                measuredT2CorrectionFactor.text = value.toFixed(0)
                            }
                        }
                    }

                        }
                    }

                    // Таблица Laser для Laser меню
                    Column {
                        id: laserGrid
            XYPoint {
                x: 5
                y: 5
            }
        }

        // Пунктирные вертикальные маркеры (делаем набором коротких сегментов)
        // 1) res_freq — жёлтый
        LineSeries { id: irMarkerResFreq0; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq1; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq2; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq3; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq4; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq5; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq6; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq7; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq8; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq9; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq10; color: "#ffd400"; width: 2 }
        LineSeries { id: irMarkerResFreq11; color: "#ffd400"; width: 2 }

        // 2) freq — белый
        LineSeries { id: irMarkerFreq0; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq1; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq2; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq3; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq4; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq5; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq6; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq7; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq8; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq9; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq10; color: "#ffffff"; width: 2 }
        LineSeries { id: irMarkerFreq11; color: "#ffffff"; width: 2 }
    }

    GraphsView {
        id: spline1
        anchors.right: parent.right
        anchors.rightMargin: 18
        anchors.top: rectangle5.bottom
        anchors.topMargin: 16
        width: 480
        height: 280
        SplineSeries {
            id: splineSeries1
            XYPoint {
                x: 1
                y: 1
            }

            XYPoint {
                x: 2
                y: 4
            }

            XYPoint {
                x: 4
                y: 2
            }

            XYPoint {
                x: 5
                y: 5
            }
        }
    }




    Rectangle {
        id: rectangle14
        anchors.left: rectangle2.right
        anchors.leftMargin: 17
        anchors.right: valuesPanel.right
        anchors.rightMargin: 0
        anchors.top: rectangle1.bottom
        anchors.topMargin: 20
        height: 39
        color: "#424242"
        radius: 15

        Text {
            id: text14
            anchors.left: parent.left
            anchors.leftMargin: 8
            anchors.verticalCenter: parent.verticalCenter
            color: "#ffffff"
            text: qsTr("Progress: Now")
            font.pixelSize: 22
        }

        Label {
            id: label2
            anchors.left: text14.right
            anchors.leftMargin: 8
            anchors.verticalCenter: parent.verticalCenter
            color: "#ffffff"
            text: qsTr("Label synthesis, NEXT: label synthesis")
            font.pointSize: 22
        }
    }

}

/*##^##
Designer {
    D{i:0}D{i:1;locked:true}D{i:49;locked:true}
}
##^##*/
